#!/usr/bin/env python3
"""
Скрипт для инициализации тестовых данных Q&A
"""

import asyncio
import os
from pathlib import Path
from dotenv import load_dotenv
from motor.motor_asyncio import AsyncIOMotorClient
from backend.models import QAQuestion, QACategory
from datetime import datetime
import uuid

# Load environment variables
ROOT_DIR = Path(__file__).parent
load_dotenv(ROOT_DIR / 'backend' / '.env')

# MongoDB connection
mongo_url = os.environ['MONGO_URL']
client = AsyncIOMotorClient(mongo_url)
db = client[os.environ['DB_NAME']]

# Test Q&A data
qa_data = [
    {
        "title": "Как правильно совершать намаз?",
        "question_text": "Ассаляму алейкум. Я новичок в исламе и хочу изучить, как правильно совершать намаз. Не могли бы вы объяснить основные этапы молитвы?",
        "answer_text": """Ва алейкум ассалям ва рахматуллахи ва баракатух.

Намаз (молитва) - это второй столп ислама и одна из важнейших обязанностей мусульманина. Вот основные этапы совершения намаза:

**1. Подготовка:**
- Совершите омовение (вуду)
- Найдите чистое место
- Повернитесь в сторону Киблы (Мекки)
- Убедитесь, что время намаза наступило

**2. Начало молитвы:**
- Поднимите руки к ушам и произнесите: "Аллаху акбар" (Аллах Велик)
- Сложите руки на груди (правая поверх левой)

**3. Чтение Корана:**
- Прочитайте суру "Аль-Фатиха"
- Прочитайте любую другую суру из Корана

**4. Поясной поклон (руку'):**
- Наклонитесь в пояс со словами "Аллаху акбар"
- Произнесите: "Субхана рабби-ль-азим" (3 раза)

**5. Земной поклон (саджда):**
- Опуститесь на землю, касаясь ее лбом, носом, ладонями, коленями и пальцами ног
- Произнесите: "Субхана рабби-ль-а'ля" (3 раза)

Это основы одного ракаата. Количество ракаатов зависит от времени намаза.

Аллах знает лучше.""",
        "category": QACategory.IBADAH,
        "tags": ["намаз", "молитва", "ракаат", "для начинающих"],
        "is_featured": True,
        "imam_name": "Шейх Ахмад",
        "references": ["Коран 2:43", "Сахих аль-Бухари 757"],
        "views_count": 1245
    },
    {
        "title": "Можно ли читать Коран на других языках?",
        "question_text": "Мой арабский пока не очень хорош. Можно ли читать Коран на русском языке для понимания? Засчитывается ли это как чтение Корана?",
        "answer_text": """Хвала Аллаху.

Это отличный вопрос, который волнует многих мусульман, для которых арабский не является родным языком.

**Чтение Корана на арабском языке:**
Коран был ниспослан на арабском языке, и чтение его на арабском имеет особую ценность и благословение. Пророк (мир ему и благословение) сказал: "Кто прочтет одну букву из Книги Аллаха, тому будет записано доброе дело, а доброе дело воздается десятикратно."

**Переводы Корана:**
- Переводы помогают понять смысл и значение аятов
- Чтение перевода - это изучение ислама, что также поощряется
- Однако перевод не может полностью передать красоту и глубину арабского оригинала

**Рекомендации:**
1. Изучайте Коран на арабском языке постепенно
2. Одновременно читайте переводы для понимания смысла
3. Используйте транслитерацию для помощи в произношении
4. Обращайтесь к знающим людям за объяснениями

Аллах видит ваши искренние намерения и вознаградит вас за стремление понять Его Слово.

Аллах знает лучше.""",
        "category": QACategory.QURAN,
        "tags": ["коран", "арабский язык", "перевод", "чтение"],
        "is_featured": True,
        "imam_name": "Имам Юсуф",
        "references": ["Коран 12:2", "Тирмизи 2910"],
        "views_count": 892
    },
    {
        "title": "Как быть справедливым в торговле?",
        "question_text": "Я занимаюсь торговлей и хочу вести бизнес согласно исламским принципам. Какие правила справедливости в торговле устанавливает ислам?",
        "answer_text": """Баракаллаху фикум за этот важный вопрос.

Ислам уделяет большое внимание честности в торговле. Вот основные принципы:

**1. Честность в описании товара:**
- Не скрывайте недостатки товара
- Предоставляйте точную информацию о качестве
- Не преувеличивайте достоинства товара

**2. Справедливые цены:**
- Не завышайте цены искусственно
- Учитывайте рыночную стоимость
- Не используйте монополию для наживы

**3. Честность в весе и мере:**
- Используйте точные весы и меры
- Не обманывайте в количестве товара

**4. Выполнение обязательств:**
- Соблюдайте договоренности
- Поставляйте товар в срок
- Возвращайте долги вовремя

**5. Запрещенные виды торговли:**
- Избегайте торговли запрещенными товарами
- Не занимайтесь ростовщичеством (риба)
- Избегайте чрезмерного риска (гарар)

Пророк (мир ему и благословение) сказал: "Честный и правдивый торговец будет с пророками, правдивыми и мучениками в День Суда."

Аллах знает лучше.""",
        "category": QACategory.MUAMALAT,
        "tags": ["торговля", "бизнес", "справедливость", "честность"],
        "imam_name": "Шейх Мухаммад",
        "references": ["Коран 83:1-3", "Тирмизи 1209"],
        "views_count": 654
    },
    {
        "title": "Что такое таухид?",
        "question_text": "Часто слышу слово 'таухид'. Что это означает и почему это так важно в исламе?",
        "answer_text": """Альхамдулиллах, это фундаментальный вопрос ислама.

**Таухид** - это единобожие, основа исламской веры. Это утверждение единственности Аллаха во всех Его атрибутах.

**Три категории таухида:**

**1. Таухид ар-Рубубийя (Единственность в господстве):**
- Аллах - единственный Творец
- Только Он управляет Вселенной
- Только Он дает жизнь и смерть

**2. Таухид аль-Улюхийя (Единственность в поклонении):**
- Поклонение только Аллаху
- Никого не приравнивать к Аллаху в поклонении
- Все виды поклонения направлять только Ему

**3. Таухид аль-Асма вас-Сифат (Единственность в именах и атрибутах):**
- Аллах обладает совершенными именами и атрибутами
- Никто не может быть похож на Аллаха в Его атрибутах
- Утверждение всех имен и качеств, которые Аллах приписал Себе

**Важность таухида:**
- Это первый и главный столп ислама
- Без таухида никакие дела не принимаются
- Это цель создания джиннов и людей

Как сказано в Коране: "Скажи: 'Он - Аллах Единый, Аллах Самодостаточный'"

Аллах знает лучше.""",
        "category": QACategory.AQIDAH,
        "tags": ["таухид", "единобожие", "вера", "основы"],
        "is_featured": True,
        "imam_name": "Шейх Абдуллах",
        "references": ["Коран 112:1-4", "Коран 51:56"],
        "views_count": 1456
    },
    {
        "title": "Как правильно относиться к родителям?",
        "question_text": "Иногда у меня возникают разногласия с родителями. Как ислам учит относиться к родителям, особенно когда мы не согласны?",
        "answer_text": """Джазакуллаху хайран за этот важный вопрос.

Отношение к родителям - одна из важнейших тем в исламе.

**Обязанности по отношению к родителям:**

**1. Повиновение в дозволенном:**
- Слушайтесь родителей во всем, что не противоречит исламу
- Если родители просят сделать что-то запрещенное, объясните это мягко

**2. Хорошее обращение:**
- Говорите с родителями мягко и уважительно
- Не повышайте голос и не грубите
- Будьте терпеливы, особенно если они стареют

**3. Практическая помощь:**
- Помогайте им в повседневной жизни
- Заботьтесь об их здоровье и потребностях
- Уделяйте им время и внимание

**4. Дуа за родителей:**
- Молитесь за них при жизни и после смерти
- Просите Аллаха простить их грехи

**При разногласиях:**
- Выражайте свою точку зрения уважительно
- Ищите компромиссы там, где это возможно
- Помните, что их опыт может быть ценным
- Никогда не прерывайте отношения из-за разногласий

В Коране сказано: "Твой Господь предписал вам поклоняться только Ему и делать добро родителям."

Аллах знает лучше.""",
        "category": QACategory.AKHLAQ,
        "tags": ["родители", "семья", "отношения", "уважение"],
        "imam_name": "Имам Омар",
        "references": ["Коран 17:23-24", "Коран 46:15"],
        "views_count": 998
    },
    {
        "title": "Можно ли слушать музыку?",
        "question_text": "Я слышал разные мнения о музыке в исламе. Можно ли мусульманину слушать музыку или это запрещено?",
        "answer_text": """Этот вопрос действительно вызывает много дискуссий среди ученых.

**Различные мнения ученых:**

**Более строгое мнение:**
- Музыка с инструментами запрещена
- Основывается на некоторых хадисах
- Разрешается только пение без инструментов

**Более мягкое мнение:**
- Музыка разрешена, если она:
  - Не содержит непристойного содержания
  - Не отвлекает от религиозных обязанностей
  - Не возбуждает низменные страсти

**Согласованные моменты:**
- Анашиды (исламские песни) без инструментов разрешены
- Музыка на свадьбах традиционно принимается
- Музыка не должна мешать намазу и другим обязанностям

**Практические рекомендации:**
1. Избегайте музыки с неприличным содержанием
2. Не позволяйте музыке отвлекать от поклонения
3. Выбирайте музыку, которая не противоречит исламским ценностям
4. При сомнениях лучше воздержаться

**Важно помнить:**
- В исламе есть вопросы, где мнения ученых расходятся
- Следуйте мнению того ученого, которому доверяете
- Главное - чистота намерений и умеренность

Аллах знает лучше.""",
        "category": QACategory.FIQH,
        "tags": ["музыка", "развлечения", "халяль", "харам"],
        "imam_name": "Шейх Ахмад",
        "references": ["Сахих аль-Бухари 5590", "Абу Дауд 4924"],
        "views_count": 756
    },
    {
        "title": "Что означает хадис о намерении?",
        "question_text": "Как понимать хадис 'Поистине, дела оцениваются только по намерениям'? Как это применять в повседневной жизни?",
        "answer_text": """Машаллах, отличный вопрос о фундаментальном принципе ислама.

**Текст хадиса:**
"Поистине, дела оцениваются только по намерениям, и каждому человеку достанется лишь то, что он намеревался получить."

**Значение намерения (ния):**
- Это искренность и направленность сердца к Аллаху
- Превращает обычные действия в поклонение
- Определяет ценность дела перед Аллахом

**Примеры применения:**

**1. В поклонении:**
- Намаз без правильного намерения недействителен
- Закят, данный для показухи, не засчитывается
- Хадж без искреннего намерения теряет смысл

**2. В повседневной жизни:**
- Работа для заработка халяль становится поклонением
- Забота о семье с намерением угодить Аллаху - это ибада
- Учеба для служения умме получает награду

**3. В отношениях:**
- Помощь людям ради Аллаха, а не для похвалы
- Благотворительность без ожидания признания
- Прощение ради довольства Аллаха

**Практические советы:**
- Перед каждым важным делом проверяйте свое намерение
- Обновляйте намерение, если оно отклоняется
- Помните, что Аллах знает, что в сердцах

Этот хадис учит нас, что в исламе важна не только внешняя форма, но и внутреннее состояние души.

Аллах знает лучше.""",
        "category": QACategory.HADITH,
        "tags": ["намерение", "хадис", "ния", "искренность"],
        "is_featured": True,
        "imam_name": "Имам Али",
        "references": ["Сахих аль-Бухари 1", "Сахих Муслим 1907"],
        "views_count": 1123
    },
    {
        "title": "Какие качества имел Пророк (мир ему)?",
        "question_text": "Хочу больше узнать о личных качествах Пророка Мухаммада (мир ему и благословение). Какими он был известен до и после пророчества?",
        "answer_text": """Салляллаху алейхи ва саллям. Изучение нрава Пророка - это великое поклонение.

**До пророчества:**

**1. Правдивость (Ас-Садик):**
- Никогда не лгал
- Люди доверяли ему свое имущество
- Даже враги признавали его честность

**2. Надежность (Аль-Амин):**
- "Надежный" - так его называли в Мекке
- Люди оставляли у него на хранение ценности
- Всегда выполнял обещания

**3. Справедливость:**
- Разрешал споры между людьми
- Был посредником в конфликтах
- Никого не обижал

**После пророчества:**

**1. Милосердие:**
- Прощал даже злейших врагов
- Был добр к детям и слабым
- Заботился о вдовах и сиротах

**2. Терпение:**
- Переносил гонения с терпением
- Не мстил за личные обиды
- Был терпелив в трудностях

**3. Простота:**
- Жил скромно, несмотря на власть
- Носил простую одежду
- Ел простую пищу

**4. Щедрость:**
- Отдавал все, что имел
- Никому не отказывал в помощи
- Предпочитал других себе

**5. Мужество:**
- Был храбрым в битвах
- Защищал слабых
- Не боялся говорить правду

Аиша (да будет доволен ею Аллах) сказала: "Его нрав был Кораном."

Аллах знает лучше.""",
        "category": QACategory.SEERAH,
        "tags": ["пророк", "сира", "качества", "нрав"],
        "is_featured": True,
        "imam_name": "Шейх Мухаммад",
        "references": ["Коран 68:4", "Сахих аль-Бухари 3559"],
        "views_count": 1678
    }
]

async def init_qa_data():
    """Инициализация тестовых данных Q&A"""
    print("Инициализация данных Q&A...")
    
    # Очистить существующие данные
    await db.qa_questions.delete_many({})
    print("Удалены существующие данные Q&A")
    
    # Добавить новые данные
    questions = []
    for data in qa_data:
        question_dict = data.copy()
        question_dict["id"] = str(uuid.uuid4())
        question_dict["created_at"] = datetime.utcnow()
        question_dict["updated_at"] = datetime.utcnow()
        
        # Создать slug
        from backend.models import create_slug
        question_dict["slug"] = create_slug(question_dict["title"])
        
        questions.append(question_dict)
    
    # Вставить в базу данных
    await db.qa_questions.insert_many(questions)
    print(f"Добавлено {len(questions)} вопросов Q&A")
    
    # Создать индексы для поиска
    await db.qa_questions.create_index([("title", "text"), ("question_text", "text"), ("answer_text", "text")])
    await db.qa_questions.create_index("category")
    await db.qa_questions.create_index("slug")
    await db.qa_questions.create_index("is_featured")
    await db.qa_questions.create_index("views_count")
    print("Созданы индексы для поиска")
    
    print("Инициализация Q&A завершена!")

if __name__ == "__main__":
    asyncio.run(init_qa_data())